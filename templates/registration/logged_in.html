{% extends "base.html" %}
{% load static %}

{% block title %}Spotify User Profile - Rewindify{% endblock %}

{% block content %}
<div class="d-flex justify-content-center align-items-center vh-100">
    <!-- Scrollable Window -->
    <div class="window-container bg-info text-white rounded shadow-lg p-4">
        <p class="display-4 text-primary text-center">Welcome, {{ profile.display_name }}</p>

        {% if profile.images.0.url %}
            <div class="text-center">
                <img src="{{ profile.images.0.url }}" alt="User Profile Image" class="rounded-circle my-4" width="150">
            </div>
        {% endif %}

        <p class="lead text-warning">Email: {{ profile.email }}</p>
        <p class="lead text-warning">Country: {{ profile.country }}</p>

        <!-- Playlists Section -->
        <h3 class="mt-4 text-primary">Your Playlists</h3>
        <ul class="list-unstyled">
            {% if playlists %}
                {% for playlist in playlists %}
                    <li class="my-3">
                        {% if playlist.images.0.url %}
                            <img src="{{ playlist.images.0.url }}" alt="{{ playlist.name }}" class="rounded my-2" width="100">
                        {% endif %}
                        <strong class="text-light">{{ playlist.name }}</strong> - <span class="text-light">{{ playlist.tracks.total }} tracks</span>
                    </li>
                {% endfor %}
            {% else %}
                <p class="text-warning">No playlists found.</p>
            {% endif %}
        </ul>

        <!-- Top Artists Section -->
        <h3 class="mt-4 text-primary">Your Top Artists</h3>
        <ul class="list-unstyled">
            {% if top_artists %}
                {% for artist in top_artists %}
                    <li class="my-3">
                        {% if artist.images.0.url %}
                            <img src="{{ artist.images.0.url }}" alt="{{ artist.name }}" class="rounded-circle my-2" width="50">
                        {% endif %}
                        <strong class="text-light">{{ artist.name }}</strong>
                    </li>
                {% endfor %}
            {% else %}
                <p class="text-warning">No top artists found.</p>
            {% endif %}
        </ul>

        <!-- Top Tracks Section -->
        <h3 class="mt-4 text-primary">Your Top Tracks</h3>
        <ul class="list-unstyled">
            {% if top_tracks %}
                {% for track in top_tracks %}
                    <li class="my-3">
                        {% if track.album_image %}
                            <img src="{{ track.album_image }}" alt="{{ track.name }}" class="rounded my-2" width="50">
                        {% endif %}
                        <strong class="text-light">{{ track.name }}</strong>
                        <span class="text-light">by
                            {% for artist in track.artists %}
                                {{ artist }}{% if not loop.last %}, {% endif %}
                            {% endfor %}
                        </span>

                        {% if track.preview_url %}
                            <div class="mt-2">
                                <audio controls>
                                    <source src="{{ track.preview_url }}" type="audio/mpeg">
                                    Your browser does not support the audio element.
                                </audio>
                            </div>
                        {% endif %}
                    </li>
                {% endfor %}
            {% else %}
                <p class="text-warning">No top tracks found.</p>
            {% endif %}
        </ul>

        <!-- Top Genres Section -->
        <h3 class="mt-4 text-primary">Your Top Genres</h3>
        <ul class="list-unstyled">
            {% if genres %}
                {% for genre in genres %}
                    <li class="my-3 text-light">{{ genre }}</li>
                {% endfor %}
            {% else %}
                <p class="text-warning">No genres found.</p>
            {% endif %}
        </ul>

        <!-- New: Total Minutes Listened Section -->
        <h3 class="mt-4 text-primary">Total Minutes Listened</h3>
        <p class="lead text-light">
            {% if total_minutes %}
                {{ total_minutes }} minutes
            {% else %}
                No listening data available.
            {% endif %}
        </p>

        <img id="wrapimage" style="max-width: 200px; height: auto; " src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSFUAfyVe3Easiycyh3isP9wDQTYuSmGPsPQvLIJdEYvQ_DsFq5Ez2Nh_QjiS3oZ3B8ZPfK9cZQyIStmQMV1lDPLw" alt="Spotify Wrap Image" />

        <button id="generateWrapButton" style="background-color:blue">Generate Wrap!</button>

        <p class="text-center my-3">
            <a href="{{ profile.external_urls.spotify }}" target="_blank" class="btn btn-success">Visit Spotify Profile</a>
        </p>

        <div class="d-flex justify-content-center mt-4">
            <a href="/" class="btn btn-primary mx-2">Back to Home</a>
        </div>
    </div>
</div>
    <script>
        var topTracks = {{ top_tracks|safe }};
        var wrapButton = document.getElementById('generateWrapButton');
        var imageElement = document.getElementById('wrapImage');

        wrapButton.addEventListener('click', function() {
            // Get the image URL from the first element of the top_tracks array
            var imageUrl = topTracks[0].album.images[0].url; // Access the URL of the first track's album image

            // Change the source of the image
            imageElement.src = imageUrl;
        });


    </script>
{% endblock %}

